{% extends "base.html" %}

{% block title %}Dashboard - MindWell{% endblock %}

{% block extra_css %}
<style>
    /* Dashboard styles */
    
    /* Your existing styles here */

    /* Mood Journey card styles */
    .mood-journey-chart {
        width: 100%;
        background-color: transparent;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        z-index: 1;
    }
    
    .mood-journey-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(139, 195, 74, 0.15);
        border-radius: 50%;
        font-size: 18px;
        color: #8bc34a;
        box-shadow: 0 0 15px rgba(139, 195, 74, 0.3);
    }
    
    .rounded-4 {
        border-radius: 16px !important;
    }
    
    .no-data-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        background-color: rgba(240, 240, 240, 0.1);
        border-radius: 8px;
        text-align: center;
    }
    
    /* Nature themed button */
    .btn-nature {
        background-color: rgba(139, 195, 74, 0.8);
        color: white;
        border: none;
        padding: 0.5rem 1.25rem;
        border-radius: 50px;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(139, 195, 74, 0.3);
    }
    
    .btn-nature:hover {
        background-color: rgba(139, 195, 74, 1);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(139, 195, 74, 0.4);
        color: white;
    }
    
    /* Clean white card for mood journey matching reference image */
    .mood-journey-card {
        position: relative;
        background: #ffffff;
        border-radius: 8px;
        border: 1px solid #e5e5e5;
        padding: 1.5rem;
        overflow: hidden;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }
    
    .mood-journey-card .section-heading {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        position: relative;
    }
    
    .mood-journey-card .heading-icon {
        width: 40px;
        height: 40px;
        background-color: #f0f9eb;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 18px;
        color: #8bc34a;
    }
    
    .mood-journey-card .heading-text h3 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
        color: #333333;
    }
    
    .mood-journey-card .heading-text p {
        margin: 0;
        font-size: 0.9rem;
        color: #717171;
    }
    
    /* Glass card for mood journey */
    .mood-journey-card .card-glow {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 50% 0%, rgba(139, 195, 74, 0.15), transparent 60%);
        pointer-events: none;
        z-index: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-page">
    <!-- Dashboard Header with Nature Theme -->
    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8 offset-lg-2 text-center">
                    <h1 class="dashboard-title">Your Wellness Dashboard</h1>
                    <p class="dashboard-subtitle">Track your journey to mental wellness</p>
                    <div class="nature-badge">
                        <i class="fas fa-leaf pulse-icon"></i>
                        <span>Nature-Inspired Healing</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Nature-themed decorative elements -->
        <div class="nature-elements">
            <div class="leaf leaf-1"></div>
            <div class="leaf leaf-2"></div>
            <div class="leaf leaf-3"></div>
            <div class="leaf leaf-4"></div>
            <div class="floating-particle particle-1"></div>
            <div class="floating-particle particle-2"></div>
            <div class="floating-particle particle-3"></div>
        </div>
    </div>
    
    <!-- Main Dashboard Content -->
    <div class="dashboard-content">
        <div class="container">
            <!-- Welcome Message and Date -->
            <div class="welcome-section">
                <div class="glass-card">
                    <div class="card-glow"></div>
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h2 class="welcome-heading">Welcome back, {{ current_user.name }}</h2>
                            <p class="welcome-text">Today is <span class="highlight-text">{{ current_date }}</span></p>
                            <p class="nature-quote">"In nature, nothing is perfect and everything is perfect." â€” Alice Walker</p>
                        </div>
                        <div class="col-md-6 text-end">
                            <div class="daily-progress">
                                <div class="progress-circle">
                                    <svg width="120" height="120" viewBox="0 0 120 120">
                                        <circle cx="60" cy="60" r="54" fill="none" stroke="#e6e6e6" stroke-width="12" />
                                        <circle cx="60" cy="60" r="54" fill="none" stroke="#8bc34a" stroke-width="12" stroke-dasharray="339.292" stroke-dashoffset="80" />
                                    </svg>
                                    <div class="progress-text">
                                        <span class="progress-percentage">75%</span>
                                        <span class="progress-label">Daily Goal</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions Section -->
            <div class="quick-actions-section">
                <h3 class="section-title">Quick Actions</h3>
                <div class="row g-4">
                    <div class="col-md-3 col-sm-6">
                        <a href="{{ url_for('mood_new') }}" class="action-card nature-card">
                            <div class="action-icon">
                                <i class="fas fa-smile"></i>
                            </div>
                            <div class="action-content">
                                <h4>Log Mood</h4>
                                <p>Track how you feel right now</p>
                            </div>
                            <div class="nature-overlay">
                                <div class="nature-bg mood-bg"></div>
                            </div>
                        </a>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <a href="{{ url_for('journal_new') }}" class="action-card nature-card">
                            <div class="action-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="action-content">
                                <h4>Journal Entry</h4>
                                <p>Write your thoughts</p>
                            </div>
                            <div class="nature-overlay">
                                <div class="nature-bg journal-bg"></div>
                            </div>
                        </a>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <a href="{{ url_for('music_dashboard') }}" class="action-card nature-card">
                            <div class="action-icon">
                                <i class="fas fa-music"></i>
                            </div>
                            <div class="action-content">
                                <h4>Music Therapy</h4>
                                <p>Relax with soothing sounds</p>
                            </div>
                            <div class="nature-overlay">
                                <div class="nature-bg music-bg"></div>
                            </div>
                        </a>
                    </div>
                    
                    <div class="col-md-3 col-sm-6">
                        <a href="{{ url_for('breathing_exercise') }}" class="action-card nature-card">
                            <div class="action-icon">
                                <i class="fas fa-tree"></i>
                            </div>
                            <div class="action-content">
                                <h4>Breathe</h4>
                                <p>Guided breathing exercise</p>
                            </div>
                            <div class="nature-overlay">
                                <div class="nature-bg breathe-bg"></div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- New Mood Journey Card -->
            <div class="row g-4 mt-4">
                <div class="col-12">
                    <div class="mood-journey-card">
                        <div class="section-heading">
                            <div class="heading-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="heading-text">
                                <h3>Your Mood Journey</h3>
                                <p>See how your mood has changed over time</p>
                            </div>
                        </div>
                        
                        <div id="moodJourneyChart" class="mood-journey-chart my-4" style="height: 300px;">
                            {% if recent_moods and recent_moods|length > 0 %}
                            <!-- Chart will be rendered here -->
                            {% else %}
                            <div class="d-flex flex-column align-items-center justify-content-center h-100">
                                <div class="mood-data-icon mb-3">
                                    <i class="fas fa-info-circle text-info fa-3x"></i>
                                </div>
                                <h5 class="text-dark">No Mood Data Yet</h5>
                                <p class="text-center text-muted">Start tracking your mood to see insights here</p>
                                <a href="{{ url_for('mood_new') }}" class="btn btn-primary mt-2">
                                    <i class="fas fa-plus-circle me-2"></i>Add First Mood Entry
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mood Tracking Summary -->
            <div class="row g-4 mt-4">
                <div class="col-lg-8">
                    <div class="glass-card mood-summary-card">
                        <div class="card-glow"></div>
                        <div class="section-heading">
                            <div class="heading-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="heading-text">
                                <h3>Your Mood Journey</h3>
                                <p>See how your mood has changed over time</p>
                            </div>
                        </div>
                        <div class="mood-chart">
                            <canvas id="moodChart"></canvas>
                        </div>
                        <div class="mood-insights">
                            {% if recent_moods %}
                                {% set trend = 0 %}
                                {% if recent_moods|length > 1 %}
                                    {% set trend = recent_moods[0].mood_score - recent_moods[-1].mood_score %}
                                {% endif %}
                                <div class="insight-item">
                                    <div class="insight-icon {% if trend >= 0 %}positive{% else %}negative{% endif %}">
                                        <i class="fas fa-{% if trend >= 0 %}arrow-up{% else %}arrow-down{% endif %}"></i>
                                    </div>
                                    <div class="insight-text">
                                        <h5>{% if trend >= 0 %}Improving{% else %}Declining{% endif %} Trend</h5>
                                        <p>Your mood has been {{ 'improving' if trend >= 0 else 'declining' }} over the past week</p>
                                    </div>
                                </div>
                                {% if mood_avg %}
                                <div class="insight-item">
                                    <div class="insight-icon">
                                        <i class="fas fa-chart-bar"></i>
                                    </div>
                                    <div class="insight-text">
                                        <h5>Average Mood: {{ mood_avg }}/5</h5>
                                        <p>Based on your recent mood entries</p>
                                    </div>
                                </div>
                                {% endif %}
                            {% else %}
                                <div class="insight-item">
                                    <div class="insight-icon">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div class="insight-text">
                                        <h5>No Mood Data Yet</h5>
                                        <p>Start tracking your mood to see insights here</p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="glass-card wellness-tips-card">
                        <div class="card-glow"></div>
                        <div class="section-heading">
                            <div class="heading-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="heading-text">
                                <h3>Nature-Inspired Tips</h3>
                                <p>Calming practices for today</p>
                            </div>
                        </div>
                        <div class="tips-list">
                            <div class="tip-item">
                                <div class="tip-icon">
                                    <i class="fas fa-seedling"></i>
                                </div>
                                <div class="tip-content">
                                    <h5>Forest Bathing</h5>
                                    <p>Spend 20 minutes under trees to reduce stress hormones</p>
                                </div>
                            </div>
                            <div class="tip-item">
                                <div class="tip-icon">
                                    <i class="fas fa-water"></i>
                                </div>
                                <div class="tip-content">
                                    <h5>Water Sounds</h5>
                                    <p>Listen to flowing water to activate your parasympathetic nervous system</p>
                                </div>
                            </div>
                            <div class="tip-item">
                                <div class="tip-icon">
                                    <i class="fas fa-cloud-sun"></i>
                                </div>
                                <div class="tip-content">
                                    <h5>Morning Light</h5>
                                    <p>Get 10 minutes of morning sunlight to regulate your circadian rhythm</p>
                                </div>
                            </div>
                            <div class="refresh-tips">
                                <button class="btn-refresh" id="refresh-tips">
                                    <i class="fas fa-sync-alt"></i> Refresh Tips
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activities and Journal Entries -->
            <div class="row g-4 mt-4">
                <div class="col-lg-4">
                    <div class="glass-card recent-activities-card">
                        <div class="card-glow"></div>
                        <div class="section-heading">
                            <div class="heading-icon">
                                <i class="fas fa-history"></i>
                            </div>
                            <div class="heading-text">
                                <h3>Recent Activities</h3>
                                <p>Your wellness journey</p>
                            </div>
                        </div>
                        <div class="activities-timeline">
                            {% if recent_activities %}
                                {% for activity in recent_activities %}
                                <div class="timeline-item">
                                    <div class="timeline-icon">
                                        {% if 'music' in activity.activity_type.lower() %}
                                            <i class="fas fa-music"></i>
                                        {% elif 'mood' in activity.activity_type.lower() %}
                                            <i class="fas fa-smile"></i>
                                        {% elif 'journal' in activity.activity_type.lower() %}
                                            <i class="fas fa-book"></i>
                                        {% elif 'focus' in activity.activity_type.lower() %}
                                            <i class="fas fa-clock"></i>
                                        {% else %}
                                            <i class="fas fa-star"></i>
                                        {% endif %}
                                    </div>
                                    <div class="timeline-content">
                                        <h5>{{ activity.activity_type }}</h5>
                                        <p>{{ activity.description }}</p>
                                        <span class="timeline-time">{{ activity.created_at|timeago }}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="empty-state">
                                    <div class="empty-icon">
                                        <i class="fas fa-history"></i>
                                    </div>
                                    <h4>No Recent Activities</h4>
                                    <p>Your activities will appear here as you use the app</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-8">
                    <div class="glass-card journal-preview-card">
                        <div class="card-glow"></div>
                        <div class="section-heading">
                            <div class="heading-icon">
                                <i class="fas fa-feather-alt"></i>
                            </div>
                            <div class="heading-text">
                                <h3>Journal Reflections</h3>
                                <p>Your recent thoughts and observations</p>
                            </div>
                            <div class="heading-action">
                                <a href="{{ url_for('journal_list') }}" class="btn-view-all">View All</a>
                            </div>
                        </div>
                        <div class="journal-entries">
                            {% if journal_entries %}
                                {% for entry in journal_entries[:2] %}
                                <div class="journal-entry">
                                    <div class="entry-header">
                                        <h4>{{ entry.title }}</h4>
                                        <span class="entry-date">{{ entry.date_created.strftime('%b %d, %Y') }}</span>
                                    </div>
                                    <div class="entry-content">
                                        <p>{{ entry.content|truncate(150) }}</p>
                                    </div>
                                    <div class="entry-footer">
                                        <a href="{{ url_for('journal_view', entry_id=entry.id) }}" class="btn-read-more">
                                            Continue Reading <i class="fas fa-arrow-right"></i>
                                        </a>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="empty-state">
                                    <div class="empty-icon">
                                        <i class="fas fa-book-open"></i>
                                    </div>
                                    <h4>No Journal Entries Yet</h4>
                                    <p>Start documenting your thoughts and feelings</p>
                                    <a href="{{ url_for('journal_new') }}" class="btn-add-entry">
                                        <i class="fas fa-plus"></i> Add First Entry
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Wellness Resources Section -->
            <div class="wellness-resources mt-4">
                <h3 class="section-title">Wellness Resources</h3>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="resource-card nature-card">
                            <div class="resource-icon">
                                <i class="fas fa-tree"></i>
                            </div>
                            <div class="resource-content">
                                <h4>Nature Sounds</h4>
                                <p>Immerse yourself in calming natural soundscapes</p>
                                <a href="#" class="btn-explore">Explore Sounds</a>
                            </div>
                            <div class="nature-overlay">
                                <div class="nature-bg forest-bg"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="resource-card nature-card">
                            <div class="resource-icon">
                                <i class="fas fa-mountain"></i>
                            </div>
                            <div class="resource-content">
                                <h4>Guided Imagery</h4>
                                <p>Mental journeys through peaceful natural settings</p>
                                <a href="#" class="btn-explore">Start Journey</a>
                            </div>
                            <div class="nature-overlay">
                                <div class="nature-bg mountain-bg"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="resource-card nature-card">
                            <div class="resource-icon">
                                <i class="fas fa-spa"></i>
                            </div>
                            <div class="resource-content">
                                <h4>Mindful Breathing</h4>
                                <p>Breathing exercises inspired by natural rhythms</p>
                                <a href="#" class="btn-explore">Begin Practice</a>
                            </div>
                            <div class="nature-overlay">
                                <div class="nature-bg spa-bg"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    {% if recent_moods and recent_moods|length > 0 %}
    // Mood Journey Chart - Modern green style as in the reference image
    const moodJourneyCtx = document.getElementById('moodJourneyChart').getContext('2d');
    
    // Format dates and collect mood scores
    const dates = [];
    const moodScores = [];
    
    {% for mood in recent_moods %}
        dates.push('{{ mood.date_created.strftime("%a") }}');
        moodScores.push({{ mood.mood_score }});
    {% endfor %}
    
    // Add data from journal entries with mood scores
    {% if journal_entries %}
        {% for entry in journal_entries %}
            {% if entry.mood_score %}
                dates.push('{{ entry.date_created.strftime("%a") }}');
                moodScores.push({{ entry.mood_score }});
            {% endif %}
        {% endfor %}
    {% endif %}
    
    // Sort dates and scores together chronologically
    const combinedData = dates.map((date, index) => {
        return { date: date, score: moodScores[index] };
    });
    
    // Sort by date (if needed)
    // combinedData.sort((a, b) => new Date(a.date) - new Date(b.date));
    
    // Extract sorted data
    const sortedDates = combinedData.map(item => item.date);
    const sortedScores = combinedData.map(item => item.score);
    
    const moodJourneyChart = new Chart(moodJourneyCtx, {
        type: 'line',
        data: {
            labels: sortedDates,
            datasets: [{
                label: 'Mood',
                data: sortedScores,
                borderColor: '#8bc34a',
                backgroundColor: 'rgba(139, 195, 74, 0.2)',
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointBackgroundColor: '#8bc34a',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: false,
                    min: 1,
                    max: 5,
                    ticks: {
                        stepSize: 1,
                        callback: function(value) {
                            if (value === 1) return 'Low';
                            if (value === 5) return 'High';
                            return '';
                        },
                        color: 'rgba(255, 255, 255, 0.7)',
                        font: {
                            size: 12
                        }
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: 'rgba(255, 255, 255, 0.7)',
                        font: {
                            size: 12
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(139, 195, 74, 0.8)',
                    titleFont: {
                        size: 14
                    },
                    bodyFont: {
                        size: 13
                    },
                    callbacks: {
                        label: function(context) {
                            const labels = ['Very Sad', 'Sad', 'Neutral', 'Happy', 'Very Happy'];
                            const score = context.raw;
                            return `Mood: ${labels[score-1]} (${score}/5)`;
                        },
                        title: function(context) {
                            return context[0].label;
                        }
                    },
                    displayColors: false,
                    padding: 10,
                    cornerRadius: 6
                }
            }
        }
    });
    {% endif %}
    
    // Existing dashboard charts
    {% if recent_moods %}
    const moodCtx = document.getElementById('moodChart').getContext('2d');
    const moodData = {
        labels: [{% for entry in recent_moods %}'{{ entry.date_created.strftime("%b %d") }}'{% if not loop.last %}, {% endif %}{% endfor %}],
        datasets: [{
            label: 'Mood Score',
            data: [{% for entry in recent_moods %}{{ entry.mood_score }}{% if not loop.last %}, {% endif %}{% endfor %}],
            borderColor: '#2ecc71',
            backgroundColor: 'rgba(46, 204, 113, 0.1)',
            borderWidth: 2,
            tension: 0.4,
            fill: true,
            pointBackgroundColor: '#2ecc71',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 5,
            pointHoverRadius: 7
        }]
    };

    new Chart(moodCtx, {
        type: 'line',
        data: moodData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 5,
                    ticks: {
                        stepSize: 1,
                        callback: function(value) {
                            return ['Very Sad', 'Sad', 'Neutral', 'Happy', 'Very Happy'][value - 1] || value;
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const score = context.raw;
                            const mood = ['Very Sad', 'Sad', 'Neutral', 'Happy', 'Very Happy'][score - 1];
                            return `Mood: ${mood} (${score}/5)`;
                        }
                    }
                }
            }
        }
    });
    {% endif %}
});
</script>
{% endblock %}
